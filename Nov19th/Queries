-- Nov19th

-- GROUP BY and HAVING

-- 17. List total payments made by each customer.
select customernumber,count(*) paymentCount from payments group by customernumber;

--18. Show customers who have made more than 3 payments.
select customernumber,count(*) paymentCount from payments group by customernumber having count(*)>3 ;

--19. Count the number of employees in each office.
select officecode,count(*) EmployeeCount from employees group by officecode;

--20. List product lines with an average product price greater than 100.
select productline,avg(buyprice) average from products group by productline  having avg(buyprice)>50;

--21. List customers with total order amount greater than 50,000.
select customernumber,sum(amount) total_order_amount from payments group by customernumber having sum(amount)>50000;

--22. Show total quantity ordered for each product code.
select productcode,sum(quantityordered) total_quantity from orderdetails group by productcode ;

--23. Display number of orders for each order status.
select status,count(ordernumber) no_of_orders from orders group by status;

--24. List employees who manage more than 2 other employees.
select reportsto from employees group by reportsto having count(employeenumber)>2;


-- ORDER BY CLAUSE

--25. Display all customers in France ordered by credit limit in descending order.
select * from customers where country='France' order by creditlimit desc;

--26. List products ordered by quantity in stock in ascending order.
select * from products order by quantityinstock ;

--27. Show all payments sorted by payment date (most recent first).
select * from payments order by paymentdate;

--28. List employees ordered by job title and then by last name.
select * from employees order by jobtitle,lastname;

--29. List the top 5 customers by credit limit.
select * from customers order by creditlimit desc limit 5;

--30. Show product lines sorted alphabetically.
select * from productlines order by productline;

--31. List the earliest 10 orders.
select * from orders order by orderdate limit 10;

--32. Display products sorted by product line and then by price.
select * from products order by productline,buyprice;


-- JOINS (INNER,RIGHT,LEFT,SELF)

--33. List all orders along with customer names (INNER JOIN).
select * from orders inner join customers on orders.customernumber=customers.customernumber; -- INNER JOIN

--34. Show employees and their managers using a self join.
select e.employeenumber EmployeeNumber,concat(e.firstname,e.lastname) EmployeeName,m.employeenumber ManagerNumber,concat(m.firstname,m.lastname) ManagerName from employees e join employees m on e.employeenumber=m.reportsto; -- SELF JOIN

--35. List all products and their order quantities (join products and orderdetails).
select p.*,o.quantityordered from products p join orderdetails o on p.productcode=o.productcode;

--36. Show customers who have not placed any orders (LEFT JOIN).
select * from customers c left join orders o on c.customernumber=o.customernumber where o.ordernumber is null;

--37. List all offices along with employees, including offices with no employees.
select o.*,e.employeenumber,concat(e.firstname,e.lastname) Employeename  from offices o  left join employees e using(officecode);

--38. Show each order's details including product name, quantity, and price.
select o.*,p.productname,p.quantityinstock,p.buyprice from orderdetails o join products p using(productcode);

